---
import type { SanityAssetDocument } from "@sanity/client";
import type { ImageUrlBuilderOptionsWithAliases } from "@sanity/image-url/lib/types/types";
import { urlForImage } from "~/sanity/lib/urlForImage";

interface Props {
  asset: SanityAssetDocument;
  alt?: string;
  className?: string;
  options?: Partial<ImageUrlBuilderOptionsWithAliases>;
}

const { asset, alt, className, options = {} } = Astro.props;

if (!asset) {
  throw new Error("SanityImage: No asset provided");
}

const url = urlForImage(asset).withOptions(options).auto("format").dpr(2).url();
---

<figure class={className}>
  <img
    src={url}
    alt={alt || ""}
    width={options.width}
    height={options.height}
  />
  <figcaption>
    <slot />
  </figcaption>
</figure>

<style>
  figcaption {
    font-size: var(--step--1);
  }
</style>
